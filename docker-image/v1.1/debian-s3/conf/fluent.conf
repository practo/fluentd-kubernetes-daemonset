
# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY, USE /templates/conf/fluent.conf.erb

@include systemd.conf
@include kubernetes.conf

<match **>
  # docs: https://docs.fluentd.org/v0.12/articles/out_s3
  # note: this configuration relies on the nodes have an IAM instance profile with access to your S3 bucket
  @type s3
  @id out_s3
  log_level info
  s3_bucket "#{ENV['S3_BUCKET_NAME']}"
  s3_region "#{ENV['S3_BUCKET_REGION']}"

  path logs/${tag}
  s3_object_key_format %{path}/%Y/%m/%d/%{index}.%{file_extension}
  format json
  include_time_key true
  <buffer tag,time>
    @type file
    path /var/log/fluentd-buffers/s3.buffer
    timekey 60
    timekey_use_utc true
    chunk_limit_size 128m
  </buffer>
  <instance_profile_credentials>
    ip_address 169.254.169.254
    port 80
  </instance_profile_credentials>
</match>
